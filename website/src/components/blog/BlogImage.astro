---
import { Image } from "astro:assets";
import { resolveBlogImage } from "@lib/blog-images";

interface Props {
  src: string;
  alt: string;
  caption?: string;
  width?: number;
  height?: number;
}

const { src, alt, caption, width, height } = Astro.props;

// Try to resolve from assets, fallback to original src
const resolvedImage = resolveBlogImage(src);
---

<figure class="my-8">
  <div class="overflow-hidden rounded-xl border border-violet-200/[.06]">
    {
      resolvedImage ? (
        <Image
          src={resolvedImage}
          alt={alt}
          width={width || resolvedImage.width}
          height={height || resolvedImage.height}
          class="w-full object-cover"
          loading="lazy"
          decoding="async"
        />
      ) : (
        <img
          src={src}
          alt={alt}
          width={width}
          height={height}
          class="w-full object-cover"
          loading="lazy"
          decoding="async"
        />
      )
    }
  </div>
  {
    caption && (
      <figcaption class="mt-3 text-center text-sm text-zinc-400">
        {caption}
      </figcaption>
    )
  }
</figure>
