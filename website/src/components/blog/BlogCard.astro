---
import type { CollectionEntry } from "astro:content";
import { Icon } from "astro-icon/components";
import { Image } from "astro:assets";
import { resolveBlogImage } from "@lib/blog-images";

interface Props {
  post: CollectionEntry<"blog">;
  featured?: boolean;
}

const { post, featured = false } = Astro.props;
const { title, publishedAt, readingTime, image } = post.data;
const slug = post.id.replace(/\.mdx$/, "");

// Resolve image from assets for Astro optimization
const resolvedImage = image?.src ? resolveBlogImage(image.src) : null;

// Format date in German
const formattedDate = new Intl.DateTimeFormat("de-DE", {
  day: "numeric",
  month: "long",
  year: "numeric",
}).format(publishedAt);
---

<article class="blog-card group/card relative">
  {/* Image */}
  <a href={`/blog/${slug}`} class="block overflow-hidden rounded-lg">
    <div class="aspect-video overflow-hidden rounded-lg">
      {
        resolvedImage ? (
          <Image
            src={resolvedImage}
            alt={image?.alt || title}
            class="h-full w-full object-cover object-center transition-transform duration-300 ease-in-out group-hover/card:scale-[1.03]"
            loading="lazy"
            decoding="async"
          />
        ) : image ? (
          <img
            src={image.src}
            alt={image.alt || title}
            class="h-full w-full object-cover object-center transition-transform duration-300 ease-in-out group-hover/card:scale-[1.03]"
            loading="lazy"
            decoding="async"
          />
        ) : (
          <div class="flex h-full w-full items-center justify-center bg-gradient-to-br from-gray-100 to-gray-200">
            <Icon name="heroicons:photo" class="h-16 w-16 text-gray-400" />
          </div>
        )
      }
    </div>
  </a>

  {/* Meta Info */}
  <div class="blog-card__meta mt-8 mb-4 flex items-center gap-x-3 text-base">
    <span>
      <time datetime={publishedAt.toISOString().split("T")[0]}>
        {formattedDate}
      </time>
    </span>
    {
      readingTime && (
        <>
          <span class="blog-card__dot size-1.5 rounded-full bg-current" />
          <span>{readingTime} Min.</span>
        </>
      )
    }
  </div>

  {/* Title */}
  <h2
    class:list={[
      "blog-card__title mb-4 font-medium text-balance lg:mb-6",
      featured ? "text-xl lg:text-2xl" : "text-xl lg:text-2xl",
    ]}
  >
    <a
      href={`/blog/${slug}`}
      class="before:absolute before:inset-0 before:block"
    >
      {title}
    </a>
  </h2>

  {/* Read More Link */}
  <a
    href={`/blog/${slug}`}
    class="blog-card__link group/link relative z-10 flex items-center gap-2 font-medium"
  >
    Artikel lesen
    <span
      class="relative flex size-6 flex-none items-center justify-center overflow-hidden"
    >
      <Icon
        name="heroicons:arrow-up-right"
        class="blog-card__arrow size-5 transition-all duration-500 ease-out group-hover/link:translate-x-full group-hover/link:-translate-y-full group-hover/link:opacity-0"
      />
      <Icon
        name="heroicons:arrow-up-right"
        class="blog-card__arrow absolute size-5 -translate-x-full translate-y-full opacity-0 transition-all duration-500 ease-out group-hover/link:translate-x-0 group-hover/link:translate-y-0 group-hover/link:opacity-100"
      />
    </span>
  </a>
</article>

<style>
  @reference "../../styles/styles.css";

  /* Meta text */
  .blog-card__meta {
    color: var(--color-gray-500);
  }

  .blog-card__dot {
    background-color: currentColor;
  }

  /* Title */
  .blog-card__title {
    color: var(--color-gray-900);
  }

  .blog-card__title a:hover {
    color: var(--primary);
  }

  /* Link */
  .blog-card__link {
    color: var(--color-gray-900);
  }

  .blog-card__arrow {
    color: var(--primary);
  }

  /* Dark mode support */
  :global([data-section-theme="dark"]) .blog-card__meta {
    color: var(--color-gray-400);
  }

  :global([data-section-theme="dark"]) .blog-card__title {
    color: var(--color-white);
  }

  :global([data-section-theme="dark"]) .blog-card__title a:hover {
    color: var(--primary-light);
  }

  :global([data-section-theme="dark"]) .blog-card__link {
    color: var(--color-white);
  }
</style>
