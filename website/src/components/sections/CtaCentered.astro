---
import Container from "@components/shared/Container.astro";
import Button from "@components/shared/Button.astro";
import { Icon } from "astro-icon/components";
import type { SectionVariant } from "../../types";

interface Props {
  sectionVariant?: SectionVariant;
  headline?: string;
  description?: string;
  buttonText?: string;
  buttonHref?: string;
  emailLabel?: string;
  email?: string;
}

const {
  sectionVariant = "dark",
  headline = "Bereit für <em>Klarheit</em>?",
  description = "Lassen Sie uns in 30 Minuten herausfinden, wo Sie stehen und was der nächste sinnvolle Schritt ist.",
  buttonText = "Erstgespräch vereinbaren",
  buttonHref = "/kontakt",
  emailLabel = "Lieber erstmal schreiben?",
  email = "kontakt@wernerstrauch.de",
} = Astro.props;

// Process headline: replace <em> tags with lime-colored spans
const highlightStyle = `color: #c8ff00;`;
const processedHeadline = headline.replace(
  /<em>(.*?)<\/em>/g,
  `<span style="${highlightStyle}">$1</span>`,
);
---

<div class="cta-section" data-variant={sectionVariant}>
  <Container class="relative max-w-[900px]">
    <div class="cta-card group relative overflow-hidden">
      {/* Diagonal Accent Line - Signature Element */}
      <div class="cta-accent-line" aria-hidden="true"></div>

      {/* Corner Accents */}
      <div class="cta-corner cta-corner--top-left" aria-hidden="true"></div>
      <div class="cta-corner cta-corner--bottom-right" aria-hidden="true"></div>

      {/* Hover Glow Effect */}
      <div class="cta-glow" aria-hidden="true"></div>

      {/* Content */}
      <div class="cta-content relative z-10 px-8 py-16 text-center sm:px-16 sm:py-20">
        {/* Headline */}
        <h2
          class="cta-headline scale-up text-3xl font-bold tracking-tight sm:text-4xl lg:text-5xl"
          style="transition-delay: 100ms;"
          set:html={processedHeadline}
        />

        {/* Description */}
        <p
          class="cta-description fade-up mx-auto mt-6 max-w-xl text-lg leading-relaxed"
          style="transition-delay: 150ms;"
        >
          {description}
        </p>

        {/* CTA Button */}
        <div
          class="fade-up mt-10"
          style="transition-delay: 200ms;"
        >
          <a
            href={buttonHref}
            class="cta-button group/btn inline-flex items-center gap-3 border px-8 py-4 text-base font-bold uppercase tracking-wider transition-all duration-300"
          >
            <Icon name="heroicons:calendar-days-16-solid" class="cta-button-icon h-5 w-5 transition-transform duration-300 group-hover/btn:scale-110" />
            <span>{buttonText}</span>
            <Icon name="heroicons:arrow-right-16-solid" class="cta-button-arrow h-4 w-4 transition-transform duration-300 group-hover/btn:translate-x-1" />
          </a>
        </div>

        {/* Email Alternative */}
        {email && (
          <div
            class="fade-up mt-8 flex flex-col items-center gap-2 sm:flex-row sm:justify-center sm:gap-3"
            style="transition-delay: 250ms;"
          >
            <span class="cta-email-label text-sm">
              {emailLabel}
            </span>
            <a
              href={`mailto:${email}`}
              class="cta-email-link inline-flex items-center gap-2 text-sm font-medium transition-all duration-300 hover:gap-3"
            >
              <Icon name="heroicons:envelope-16-solid" class="h-4 w-4" />
              <span>{email}</span>
            </a>
          </div>
        )}
      </div>

      {/* Bottom Accent Bar */}
      <div class="cta-bottom-bar" aria-hidden="true"></div>
    </div>
  </Container>
</div>

<script>
  import "@scripts/animations";

  function initCtaHoverEffect(): void {
    const cards = document.querySelectorAll<HTMLDivElement>(".cta-card");

    cards.forEach((card) => {
      card.addEventListener("mousemove", (event: MouseEvent) => {
        const rect = card.getBoundingClientRect();
        const x = event.clientX - rect.left;
        const y = event.clientY - rect.top;

        const glowElement = card.querySelector(".cta-glow") as HTMLElement;
        if (glowElement) {
          glowElement.style.background = `radial-gradient(600px circle at ${x}px ${y}px, rgba(200, 255, 0, 0.08), transparent 40%)`;
          glowElement.style.opacity = "1";
        }
      });

      card.addEventListener("mouseleave", () => {
        const glowElement = card.querySelector(".cta-glow") as HTMLElement;
        if (glowElement) {
          glowElement.style.opacity = "0";
        }
      });
    });
  }

  initCtaHoverEffect();
  document.addEventListener("astro:after-swap", initCtaHoverEffect);
</script>

<style>
  /* ========================================
     CTA Section - Industrial Refined Style
     Navy + Lime, Clean Lines, No Border-Radius
     ======================================== */

  .cta-card {
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.08);
    position: relative;
  }

  /* ========================================
     Diagonal Accent Line - Signature Element
     ======================================== */
  .cta-accent-line {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(
      90deg,
      transparent 0%,
      #c8ff00 20%,
      #c8ff00 80%,
      transparent 100%
    );
    opacity: 0.8;
  }

  /* ========================================
     Corner Accents
     ======================================== */
  .cta-corner {
    position: absolute;
    width: 24px;
    height: 24px;
    opacity: 0.4;
    transition: opacity 0.3s ease;
  }

  .cta-card:hover .cta-corner {
    opacity: 0.8;
  }

  .cta-corner--top-left {
    top: 0;
    left: 0;
    border-top: 2px solid #c8ff00;
    border-left: 2px solid #c8ff00;
  }

  .cta-corner--bottom-right {
    bottom: 0;
    right: 0;
    border-bottom: 2px solid #c8ff00;
    border-right: 2px solid #c8ff00;
  }

  /* ========================================
     Hover Glow Effect
     ======================================== */
  .cta-glow {
    position: absolute;
    inset: 0;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
  }

  /* ========================================
     Headline
     ======================================== */
  .cta-headline {
    color: #ffffff;
  }

  /* ========================================
     Description
     ======================================== */
  .cta-description {
    color: rgba(255, 255, 255, 0.7);
  }

  /* ========================================
     CTA Button - Industrial Style
     ======================================== */
  .cta-button {
    background: #c8ff00;
    border-color: #c8ff00;
    color: #0a1628;
  }

  .cta-button:hover {
    background: transparent;
    border-color: #c8ff00;
    color: #c8ff00;
    box-shadow: 0 0 30px rgba(200, 255, 0, 0.2);
  }

  .cta-button-icon {
    color: #0a1628;
  }

  .cta-button:hover .cta-button-icon {
    color: #c8ff00;
  }

  .cta-button-arrow {
    color: #0a1628;
  }

  .cta-button:hover .cta-button-arrow {
    color: #c8ff00;
  }

  /* ========================================
     Email Alternative
     ======================================== */
  .cta-email-label {
    color: rgba(255, 255, 255, 0.5);
  }

  .cta-email-link {
    color: #c8ff00;
    text-decoration: underline;
    text-underline-offset: 3px;
  }

  .cta-email-link:hover {
    opacity: 0.8;
  }

  /* ========================================
     Bottom Accent Bar
     ======================================== */
  .cta-bottom-bar {
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 2px;
    background: #c8ff00;
    transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .cta-card:hover .cta-bottom-bar {
    width: 60%;
  }

</style>
