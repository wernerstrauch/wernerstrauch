---
import Container from "@components/shared/Container.astro";
import Eyebrow from "@components/shared/Eyebrow.astro";
import { Icon } from "astro-icon/components";
import type { SectionVariant } from "../../types";

interface Principle {
  title: string;
  description: string;
  contrast: string;
}

interface Props {
  sectionVariant?: SectionVariant;
  badge?: string;
  badgeIcon?: string;
  headline?: string;
  intro?: string;
  principles?: Principle[];
}

const {
  sectionVariant = "dark",
  badge,
  badgeIcon,
  headline = "Meine Prinzipien",
  intro = "So arbeite ich â€“ und so nicht.",
  principles = [],
} = Astro.props;

// Process headline: replace <em> tags with accent-colored spans
const highlightStyle = `color: var(--section-accent);`;
const processedHeadline = headline.replace(
  /<em>(.*?)<\/em>/g,
  `<span style="${highlightStyle}">$1</span>`,
);
---

<div class="principles-section" data-variant={sectionVariant}>
  <Container class="relative max-w-6xl">
    {/* Header */}
    <div class="mb-16 text-center lg:mb-20">
      {/* Eyebrow */}
      {badge && (
        <div class="mb-6 flex justify-center">
          <Eyebrow text={badge} icon={badgeIcon || "heroicons:shield-check-16-solid"} />
        </div>
      )}

      <h2
        class="principles-headline scale-up text-3xl leading-tight font-bold sm:text-4xl lg:text-5xl"
        style="transition-delay: 100ms;"
        set:html={processedHeadline}
      />
      {
        intro && (
          <p
            class="principles-intro fade-up mx-auto mt-5 max-w-xl text-lg lg:text-xl"
            style="transition-delay: 150ms;"
          >
            {intro}
          </p>
        )
      }
    </div>

    {/* Principles Grid - Asymmetric 2-Column Layout */}
    <div class="principles-grid">
      {
        principles.map((principle, index) => (
          <div
            class="principles-card fade-up group relative overflow-hidden"
            style={`transition-delay: ${200 + index * 100}ms;`}
            data-index={index}
          >
            {/* Top Accent Line */}
            <div class="principles-accent-line" aria-hidden="true" />

            {/* Corner Accents */}
            <div class="principles-corner principles-corner--top-left" aria-hidden="true" />
            <div class="principles-corner principles-corner--bottom-right" aria-hidden="true" />

            {/* Hover Glow */}
            <div class="principles-glow" aria-hidden="true" />

            {/* Large Number */}
            <div class="principles-number" aria-hidden="true">
              {String(index + 1).padStart(2, "0")}
            </div>

            {/* Content */}
            <div class="principles-content relative z-10">
              {/* Title */}
              <h3 class="principles-title">
                {principle.title}
              </h3>

              {/* Description */}
              <p class="principles-description">
                {principle.description}
              </p>

              {/* Contrast Block */}
              <div class="principles-contrast">
                <div class="principles-contrast-indicator" aria-hidden="true">
                  <Icon name="heroicons:arrow-right-16-solid" class="h-4 w-4" />
                </div>
                <p class="principles-contrast-text">
                  {principle.contrast}
                </p>
              </div>
            </div>

            {/* Bottom Progress Bar on Hover */}
            <div class="principles-bottom-bar" aria-hidden="true" />
          </div>
        ))
      }
    </div>
  </Container>
</div>

<script>
  import "@scripts/animations";

  function initPrinciplesHover(): void {
    const cards = document.querySelectorAll<HTMLDivElement>(".principles-card");

    cards.forEach((card) => {
      card.addEventListener("mousemove", (event: MouseEvent) => {
        const rect = card.getBoundingClientRect();
        const x = event.clientX - rect.left;
        const y = event.clientY - rect.top;

        const glowElement = card.querySelector(".principles-glow") as HTMLElement;
        if (glowElement) {
          glowElement.style.background = `radial-gradient(500px circle at ${x}px ${y}px, rgba(200, 255, 0, 0.06), transparent 40%)`;
          glowElement.style.opacity = "1";
        }
      });

      card.addEventListener("mouseleave", () => {
        const glowElement = card.querySelector(".principles-glow") as HTMLElement;
        if (glowElement) {
          glowElement.style.opacity = "0";
        }
      });
    });
  }

  initPrinciplesHover();
  document.addEventListener("astro:after-swap", initPrinciplesHover);
</script>

<style>
  /* ========================================
     Principles Section - Industrial Refined
     Navy + Lime, Numbered Cards, Diagonal Accents
     ======================================== */

  /* ========================================
     Eyebrow Styles - Simple text like other sections
     ======================================== */
  .principles-eyebrow {
    color: var(--section-accent);
    letter-spacing: 0.1em;
  }

  /* ========================================
     Headline Styles
     ======================================== */
  .principles-headline {
    color: var(--section-text);
  }

  .principles-intro {
    color: var(--section-text-muted);
  }

  /* ========================================
     Grid Layout - Asymmetric with stagger
     ======================================== */
  .principles-grid {
    display: grid;
    gap: 1.5rem;
  }

  @media (min-width: 768px) {
    .principles-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 2rem;
    }

    /* Stagger effect - odd cards slightly lower */
    .principles-card:nth-child(odd) {
      margin-top: 0;
    }

    .principles-card:nth-child(even) {
      margin-top: 2.5rem;
    }
  }

  /* ========================================
     Card Styles - Glassmorphism + Industrial
     ======================================== */
  .principles-card {
    position: relative;
    background: var(--section-card-bg);
    border: 1px solid var(--section-card-border);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    padding: 2rem;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  @media (min-width: 640px) {
    .principles-card {
      padding: 2.5rem;
    }
  }

  .principles-card:hover {
    border-color: rgba(255, 255, 255, 0.12);
    background: rgba(255, 255, 255, 0.04);
    transform: translateY(-4px);
  }

  /* ========================================
     Top Accent Line
     ======================================== */
  .principles-accent-line {
    position: absolute;
    top: 0;
    left: 0;
    width: 0;
    height: 3px;
    background: var(--section-accent);
    transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .principles-card:hover .principles-accent-line {
    width: 100%;
  }

  /* ========================================
     Corner Accents
     ======================================== */
  .principles-corner {
    position: absolute;
    width: 16px;
    height: 16px;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .principles-card:hover .principles-corner {
    opacity: 0.6;
  }

  .principles-corner--top-left {
    top: 0;
    left: 0;
    border-top: 2px solid var(--section-accent);
    border-left: 2px solid var(--section-accent);
  }

  .principles-corner--bottom-right {
    bottom: 0;
    right: 0;
    border-bottom: 2px solid var(--section-accent);
    border-right: 2px solid var(--section-accent);
  }

  /* ========================================
     Hover Glow Effect
     ======================================== */
  .principles-glow {
    position: absolute;
    inset: 0;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
  }

  /* ========================================
     Large Number - Watermark Style
     ======================================== */
  .principles-number {
    position: absolute;
    top: 0.75rem;
    right: 1rem;
    font-size: 4rem;
    font-weight: 800;
    line-height: 1;
    color: var(--section-accent);
    opacity: 0.08;
    pointer-events: none;
    transition: all 0.4s ease;
    font-variant-numeric: tabular-nums;
  }

  @media (min-width: 640px) {
    .principles-number {
      font-size: 5rem;
      top: 1rem;
      right: 1.5rem;
    }
  }

  .principles-card:hover .principles-number {
    opacity: 0.15;
    transform: scale(1.05);
  }

  /* ========================================
     Content Styles
     ======================================== */
  .principles-content {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .principles-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--section-text);
    line-height: 1.3;
    transition: color 0.3s ease;
  }

  @media (min-width: 640px) {
    .principles-title {
      font-size: 1.375rem;
    }
  }

  .principles-card:hover .principles-title {
    color: var(--section-accent);
  }

  .principles-description {
    font-size: 0.9375rem;
    line-height: 1.7;
    color: var(--section-text-muted);
  }

  @media (min-width: 640px) {
    .principles-description {
      font-size: 1rem;
    }
  }

  /* ========================================
     Contrast Block - Visual Distinction
     ======================================== */
  .principles-contrast {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    margin-top: 0.5rem;
    padding: 1rem;
    background: color-mix(in srgb, var(--section-accent) 5%, transparent);
    border-left: 3px solid var(--section-accent);
    transition: all 0.3s ease;
  }

  .principles-card:hover .principles-contrast {
    background: color-mix(in srgb, var(--section-accent) 8%, transparent);
  }

  .principles-contrast-indicator {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    width: 1.5rem;
    height: 1.5rem;
    background: var(--section-accent);
    color: #0a1628;
    transition: transform 0.3s ease;
  }

  .principles-card:hover .principles-contrast-indicator {
    transform: translateX(4px);
  }

  .principles-contrast-text {
    font-size: 0.875rem;
    font-weight: 500;
    font-style: italic;
    color: var(--section-accent);
    line-height: 1.5;
  }

  /* ========================================
     Bottom Progress Bar
     ======================================== */
  .principles-bottom-bar {
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 2px;
    background: var(--section-accent);
    transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .principles-card:hover .principles-bottom-bar {
    width: 40%;
  }

</style>
