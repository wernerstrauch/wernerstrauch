---
import Button from "@components/shared/Button.astro";
import { Icon } from "astro-icon/components";
import type { SectionVariant } from "../../types";

interface Props {
  sectionVariant?: SectionVariant;
  badge?: string;
  badgeIcon?: string;
  headline: string;
  subheadline: string;
  primaryCta?: string;
  primaryCtaHref?: string;
  secondaryCta?: string;
  secondaryCtaHref?: string;
  backgroundImage: string;
  backgroundImageAlt?: string;
  announcementText?: string;
  announcementLink?: string;
  announcementLinkText?: string;
}

const {
  sectionVariant = "dark",
  badge,
  badgeIcon = "heroicons:sparkles-16-solid",
  headline,
  subheadline,
  primaryCta = "Kostenloses Erstgespr√§ch",
  primaryCtaHref,
  secondaryCta = "Mehr erfahren",
  secondaryCtaHref = "#services",
  backgroundImage,
  backgroundImageAlt = "",
  announcementText,
  announcementLink,
  announcementLinkText = "Mehr erfahren",
} = Astro.props;

// Variant-based styles
const isDarkVariant = sectionVariant === "dark" || sectionVariant === "primary";

// Button variants
const primaryButtonVariant = sectionVariant === "primary" ? "white" : "primary";
const secondaryButtonVariant = isDarkVariant ? "secondary-dark" : "secondary";

// Process headline: replace <em> tags with styled spans using CSS variable
const highlightStyle = `color: var(--section-accent);`;
const processedHeadline = headline.replace(
  /<em>(.*?)<\/em>/g,
  `<span style="${highlightStyle}">$1</span>`,
);
---

<div
  id="hero"
  class="herobackground-section relative isolate overflow-hidden pt-20 sm:pt-24 lg:pt-14"
  data-variant={sectionVariant}
>
  {/* Background Image */}
  <img
    src={backgroundImage}
    alt={backgroundImageAlt}
    class="absolute inset-0 -z-20 h-full w-full object-cover"
  />

  {/* Overlay */}
  <div class="herobackground-overlay absolute inset-0 -z-10"></div>

  {/* Top Gradient Blur */}
  <div
    aria-hidden="true"
    class="absolute inset-x-0 -top-40 -z-10 transform-gpu overflow-hidden blur-3xl sm:-top-80"
  >
    <div
      style="clip-path: polygon(74.1% 44.1%, 100% 61.6%, 97.5% 26.9%, 85.5% 0.1%, 80.7% 2%, 72.5% 32.5%, 60.2% 62.4%, 52.4% 68.1%, 47.5% 58.3%, 45.2% 34.5%, 27.5% 76.7%, 0.1% 64.9%, 17.9% 100%, 27.6% 76.8%, 76.1% 97.7%, 74.1% 44.1%)"
      class="herobackground-gradient-blob relative left-[calc(50%-11rem)] aspect-[1155/678] w-[36.125rem] -translate-x-1/2 rotate-[30deg] sm:left-[calc(50%-30rem)] sm:w-[72.1875rem]"
    >
    </div>
  </div>

  <div class="mx-auto max-w-7xl px-6 lg:px-8">
    <div class="mx-auto max-w-2xl py-24 sm:py-32 lg:py-40">
      {/* Announcement Banner */}
      {
        announcementText && (
          <div class="blur-in mb-8 hidden sm:flex sm:justify-center">
            <div class="herobackground-announcement relative rounded-full px-3 py-1 text-sm/6 ring-1">
              {announcementText}{" "}
              {announcementLink && (
                <a
                  href={announcementLink}
                  class="herobackground-announcement-link font-semibold"
                >
                  <span aria-hidden="true" class="absolute inset-0" />
                  {announcementLinkText} <span aria-hidden="true">&rarr;</span>
                </a>
              )}
            </div>
          </div>
        )
      }

      {/* Badge */}
      {
        badge && !announcementText && (
          <div class="blur-in mb-8 flex justify-center">
            <div class="herobackground-badge shadow-inner-blur flex items-center rounded-full">
              <div class="herobackground-badge-inner flex h-full w-full items-center space-x-2 rounded-full border px-4 py-1.5">
                <Icon
                  name={badgeIcon}
                  class="herobackground-badge-icon h-4 w-4"
                />
                <span class="herobackground-badge-text text-sm font-medium">
                  {badge}
                </span>
              </div>
            </div>
          </div>
        )
      }

      <div class="text-center">
        {/* Headline */}
        <h1
          class="herobackground-headline scale-up text-4xl font-bold tracking-tight text-balance sm:text-5xl lg:text-6xl"
          style="transition-delay: 100ms;"
          set:html={processedHeadline}
        />

        {/* Subheadline */}
        <p
          class="herobackground-subheadline fade-up mx-auto mt-8 max-w-xl text-lg font-medium text-pretty sm:text-xl/8"
          style="transition-delay: 200ms;"
        >
          {subheadline}
        </p>

        {/* CTAs */}
        <div
          class="fade-up mt-10 flex flex-col items-center justify-center gap-4 sm:flex-row sm:gap-6"
          style="transition-delay: 300ms;"
        >
          <Button
            data-open-funnel={!primaryCtaHref}
            href={primaryCtaHref}
            variant={primaryButtonVariant}
            size="lg"
          >
            <Icon name="heroicons:calendar-days-16-solid" class="h-4 w-4" />
            <span>{primaryCta}</span>
          </Button>
          <Button
            href={secondaryCtaHref}
            variant={secondaryButtonVariant}
            size="lg"
          >
            <span>{secondaryCta}</span>
            <Icon name="heroicons:arrow-right-16-solid" class="h-4 w-4" />
          </Button>
        </div>
      </div>
    </div>
  </div>

  {/* Bottom Gradient Blur */}
  <div
    aria-hidden="true"
    class="absolute inset-x-0 top-[calc(100%-13rem)] -z-10 transform-gpu overflow-hidden blur-3xl sm:top-[calc(100%-30rem)]"
  >
    <div
      style="clip-path: polygon(74.1% 44.1%, 100% 61.6%, 97.5% 26.9%, 85.5% 0.1%, 80.7% 2%, 72.5% 32.5%, 60.2% 62.4%, 52.4% 68.1%, 47.5% 58.3%, 45.2% 34.5%, 27.5% 76.7%, 0.1% 64.9%, 17.9% 100%, 27.6% 76.8%, 76.1% 97.7%, 74.1% 44.1%)"
      class="herobackground-gradient-blob relative left-[calc(50%+3rem)] aspect-[1155/678] w-[36.125rem] -translate-x-1/2 sm:left-[calc(50%+36rem)] sm:w-[72.1875rem]"
    >
    </div>
  </div>
</div>

<script>
  import "@scripts/animations";
</script>

<style>
  /* ========================================
     Uses --section-* variables set by data-section-theme
     attribute on parent Section component
     ======================================== */

  /* ========================================
     Overlay styles
     ======================================== */
  .herobackground-overlay {
    background: color-mix(in srgb, var(--section-bg) 80%, transparent);
  }

  /* ========================================
     Badge styles
     ======================================== */
  .herobackground-badge {
    background: color-mix(in srgb, var(--section-accent) 15%, transparent);
  }

  .herobackground-badge-inner {
    border-color: color-mix(in srgb, var(--section-accent) 30%, transparent);
  }

  .herobackground-badge-icon {
    color: var(--section-accent);
  }

  .herobackground-badge-text {
    color: var(--section-text);
  }

  /* ========================================
     Headline styles
     ======================================== */
  .herobackground-headline {
    color: var(--section-text);
  }

  .herobackground-subheadline {
    color: var(--section-text-muted);
  }

  /* ========================================
     Announcement styles
     ======================================== */
  .herobackground-announcement {
    color: var(--section-text-muted);
    --tw-ring-color: color-mix(in srgb, var(--section-text) 10%, transparent);
  }

  .herobackground-announcement:hover {
    --tw-ring-color: color-mix(in srgb, var(--section-text) 20%, transparent);
  }

  .herobackground-announcement-link {
    color: var(--section-accent);
  }

  /* ========================================
     Gradient blob styles
     ======================================== */
  .herobackground-gradient-blob {
    background: linear-gradient(
      to top right,
      color-mix(in srgb, var(--section-accent) 30%, transparent),
      color-mix(in srgb, var(--section-accent) 20%, transparent)
    );
    opacity: 0.2;
  }
</style>
