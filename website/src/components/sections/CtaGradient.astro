---
import Container from "@components/shared/Container.astro";
import Button from "@components/shared/Button.astro";
import { Icon } from "astro-icon/components";
import type { SectionVariant } from "../../types";

interface Props {
  sectionVariant?: SectionVariant;
  headline?: string;
  description?: string;
  primaryCta?: string;
  primaryCtaHref?: string;
  secondaryCta?: string;
  secondaryCtaHref?: string;
}

const {
  sectionVariant = "white",
  headline = "Bereit für mehr <em>Wachstum?</em>",
  description = "Lass uns gemeinsam herausfinden, wo dein Shop das größte Potenzial hat. Im kostenlosen Erstgespräch analysieren wir deine Situation und zeigen dir konkrete nächste Schritte.",
  primaryCta = "Kostenloses Erstgespräch",
  primaryCtaHref,
  secondaryCta = "Mehr erfahren",
  secondaryCtaHref = "/ueber-uns",
} = Astro.props;

// Variant-based styles
const isDarkVariant = sectionVariant === "dark" || sectionVariant === "primary";

// Button variant
const primaryButtonVariant = isDarkVariant ? "white" : "primary";

// Process headline: replace <em> tags with styled spans using CSS variable
const highlightStyle = `color: var(--section-accent);`;
const processedHeadline = headline.replace(
  /<em>(.*?)<\/em>/g,
  `<span style="${highlightStyle}">$1</span>`,
);

// Generate unique ID for gradient
const gradientId = `cta-gradient-${Math.random().toString(36).substring(2, 11)}`;
---

<Container class="ctagradient-section" data-variant={sectionVariant}>
  <div class="relative isolate overflow-hidden py-16 sm:py-20 lg:py-24">
    <div class="mx-auto max-w-2xl text-center">
      {/* Headline */}
      <h2
        class="ctagradient-headline scale-up text-3xl font-bold tracking-tight text-balance sm:text-4xl lg:text-5xl"
        style="transition-delay: 100ms;"
        set:html={processedHeadline}
      />

      {/* Description */}
      <p
        class="ctagradient-description fade-up mx-auto mt-6 max-w-xl text-lg/8 text-pretty"
        style="transition-delay: 150ms;"
      >
        {description}
      </p>

      {/* CTAs */}
      <div
        class="fade-up mt-10 flex flex-col items-center justify-center gap-4 sm:flex-row sm:gap-6"
        style="transition-delay: 200ms;"
      >
        {
          primaryCta && (
            <Button
              href={primaryCtaHref}
              variant={primaryButtonVariant}
              size="lg"
              data-open-funnel={!primaryCtaHref}
            >
              <Icon name="heroicons:calendar-days-16-solid" class="h-4 w-4" />
              <span>{primaryCta}</span>
            </Button>
          )
        }
        {
          secondaryCta && secondaryCtaHref && (
            <a
              href={secondaryCtaHref}
              class="ctagradient-secondary-link group inline-flex items-center gap-1 text-sm font-semibold transition-colors"
            >
              {secondaryCta}
              <span
                aria-hidden="true"
                class="transition-transform group-hover:translate-x-0.5"
              >
                →
              </span>
            </a>
          )
        }
      </div>
    </div>

    {/* Background Glow Effect - from bottom center */}
    <svg
      viewBox="0 0 1024 1024"
      aria-hidden="true"
      class="ctagradient-glow absolute -bottom-1/4 left-1/2 -z-10 h-[48rem] w-[48rem] -translate-x-1/2 translate-y-1/2 [mask-image:radial-gradient(closest-side,white,transparent)]"
    >
      <circle
        r="512"
        cx="512"
        cy="512"
        fill={`url(#${gradientId})`}
        class="ctagradient-glow-circle"></circle>
      <defs>
        <radialGradient id={gradientId}>
          <stop class="ctagradient-glow-start"></stop>
          <stop offset="1" class="ctagradient-glow-end"></stop>
        </radialGradient>
      </defs>
    </svg>
  </div>
</Container>

<style>
  /* ========================================
     Uses --section-* variables set by data-section-theme
     attribute on parent Section component
     ======================================== */

  /* ========================================
     Headline styles
     ======================================== */
  .ctagradient-headline {
    color: var(--section-text);
  }

  .ctagradient-description {
    color: var(--section-text-muted);
  }

  /* ========================================
     Secondary link styles
     ======================================== */
  .ctagradient-secondary-link {
    color: var(--section-text);
  }

  .ctagradient-secondary-link:hover {
    color: var(--section-accent);
  }

  /* ========================================
     Glow effect
     ======================================== */
  .ctagradient-glow-circle {
    fill-opacity: 0.5;
  }

  [data-variant="primary"] .ctagradient-glow-circle {
    fill-opacity: 0.12;
  }

  .ctagradient-glow-start {
    stop-color: var(--section-accent);
  }

  .ctagradient-glow-end {
    stop-color: color-mix(in srgb, var(--section-accent) 60%, var(--primary));
  }
</style>
