---
import Container from "@components/shared/Container.astro";
import { Icon } from "astro-icon/components";
import type { SectionVariant } from "../../types";

interface Credential {
  icon?: string;
  title: string;
  subtitle: string;
  institution?: string;
  period?: string;
  highlight?: boolean;
  badge?: string;
  highlights?: string[];
}

interface Props {
  sectionVariant?: SectionVariant;
  badge?: string;
  badgeIcon?: string;
  headline?: string;
  tagline?: string;
  credentials?: Credential[];
}

const {
  sectionVariant = "dark",
  badge,
  badgeIcon = "heroicons:academic-cap-16-solid",
  headline = "Fundierte <em>Ausbildung</em>",
  tagline,
  credentials = [],
} = Astro.props;

// Process headline: replace <em> tags with styled spans
const highlightStyle = `color: var(--section-accent);`;
const processedHeadline = headline.replace(
  /<em>(.*?)<\/em>/g,
  `<span style="${highlightStyle}">$1</span>`,
);

// Check if single credential mode
const isSingleCredential = credentials.length === 1;
const primaryCredential = credentials.find((c) => c.highlight) || credentials[0];
const secondaryCredentials = credentials.filter((c) => !c.highlight && c !== primaryCredential);
---

<div class="credentials-section" data-variant={sectionVariant}>
  <Container class="max-w-4xl">
    {/* Single Credential - Centered Hero Layout */}
    {isSingleCredential && primaryCredential && (
      <div class="credential-hero fade-up" style="transition-delay: 100ms;">
        {/* Decorative Elements */}
        <div class="credential-hero__decoration">
          <div class="credential-hero__ring credential-hero__ring--1"></div>
          <div class="credential-hero__ring credential-hero__ring--2"></div>
          <div class="credential-hero__ring credential-hero__ring--3"></div>
        </div>

        {/* Icon */}
        <div class="credential-hero__icon-wrapper">
          <Icon
            name={primaryCredential.icon || "heroicons:academic-cap"}
            class="credential-hero__icon"
          />
        </div>

        {/* Badge */}
        {badge && (
          <div class="credential-hero__badge">
            <Icon name={badgeIcon} class="h-3.5 w-3.5" />
            <span>{badge}</span>
          </div>
        )}

        {/* Main Title */}
        <h2 class="credential-hero__title">
          {primaryCredential.title}
        </h2>

        {/* Subtitle with Accent */}
        <p class="credential-hero__subtitle">
          {primaryCredential.subtitle}
        </p>

        {/* Meta Info */}
        <div class="credential-hero__meta">
          {primaryCredential.institution && (
            <div class="credential-hero__meta-item">
              <Icon name="heroicons:building-library" class="h-5 w-5" />
              <span>{primaryCredential.institution}</span>
            </div>
          )}
          {primaryCredential.period && (
            <div class="credential-hero__meta-item">
              <Icon name="heroicons:calendar" class="h-5 w-5" />
              <span>{primaryCredential.period}</span>
            </div>
          )}
        </div>

        {/* Highlights/Tags */}
        {primaryCredential.highlights && primaryCredential.highlights.length > 0 && (
          <div class="credential-hero__highlights">
            {primaryCredential.highlights.map((highlight, index) => (
              <span
                class="credential-hero__highlight-tag fade-up"
                style={`transition-delay: ${200 + index * 50}ms;`}
              >
                <Icon name="heroicons:check-circle-16-solid" class="h-4 w-4" />
                {highlight}
              </span>
            ))}
          </div>
        )}
      </div>
    )}

    {/* Multiple Credentials Layout */}
    {!isSingleCredential && (
      <>
        {/* Header */}
        <div class="mb-12 lg:mb-16">
          {badge && (
            <div class="blur-in mb-6 flex">
              <div class="credentials-badge">
                <Icon name={badgeIcon} class="credentials-badge-icon h-4 w-4" />
                <span class="credentials-badge-text">{badge}</span>
              </div>
            </div>
          )}

          <h2
            class="credentials-headline scale-up"
            style="transition-delay: 100ms;"
            set:html={processedHeadline}
          />

          {tagline && (
            <p class="credentials-tagline fade-up" style="transition-delay: 150ms;">
              {tagline}
            </p>
          )}
        </div>

        {/* Credentials Grid */}
        <div class="credentials-grid">
          {/* Primary Credential - Large Hero Card */}
          {primaryCredential && (
            <div
              class="credential-card credential-card--primary fade-up group"
              style="transition-delay: 200ms;"
            >
              <div class="credential-card__pattern"></div>
              <div class="credential-card__glow"></div>

              <div class="credential-card__content">
                <div class="credential-card__icon-wrapper credential-card__icon-wrapper--primary">
                  <Icon
                    name={primaryCredential.icon || "heroicons:academic-cap"}
                    class="credential-card__icon"
                  />
                </div>

                <div class="credential-card__text">
                  <h3 class="credential-card__title credential-card__title--primary">
                    {primaryCredential.title}
                  </h3>
                  <p class="credential-card__subtitle credential-card__subtitle--primary">
                    {primaryCredential.subtitle}
                  </p>

                  <div class="credential-card__meta">
                    {primaryCredential.institution && (
                      <div class="credential-card__meta-item">
                        <Icon name="heroicons:building-library" class="h-4 w-4" />
                        <span>{primaryCredential.institution}</span>
                      </div>
                    )}
                    {primaryCredential.period && (
                      <div class="credential-card__meta-item">
                        <Icon name="heroicons:calendar" class="h-4 w-4" />
                        <span>{primaryCredential.period}</span>
                      </div>
                    )}
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* Secondary Credentials */}
          {secondaryCredentials.length > 0 && (
            <div class="credentials-secondary-grid">
              {secondaryCredentials.map((credential, index) => (
                <div
                  class="credential-card credential-card--secondary fade-up group"
                  style={`transition-delay: ${300 + index * 100}ms;`}
                >
                  <div class="credential-card__content credential-card__content--row">
                    <div class="credential-card__icon-wrapper credential-card__icon-wrapper--secondary">
                      <Icon
                        name={credential.icon || "heroicons:document-check"}
                        class="credential-card__icon credential-card__icon--small"
                      />
                    </div>

                    <div class="credential-card__text">
                      <h3 class="credential-card__title credential-card__title--secondary">
                        {credential.title}
                      </h3>
                      <p class="credential-card__subtitle credential-card__subtitle--secondary">
                        {credential.subtitle}
                      </p>
                      {credential.institution && (
                        <p class="credential-card__institution">
                          {credential.institution}
                        </p>
                      )}
                    </div>
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      </>
    )}
  </Container>
</div>

<script>
  import "@scripts/animations";
</script>

<style>
  /* ========================================
     Main Container
     ======================================== */
  .credentials-section {
    position: relative;
  }

  /* ========================================
     Badge Styles
     ======================================== */
  .credentials-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: color-mix(in srgb, var(--section-accent) 10%, transparent);
    border: 1px solid color-mix(in srgb, var(--section-accent) 25%, transparent);
    border-radius: 9999px;
  }

  .credentials-badge-icon {
    color: var(--section-accent);
  }

  .credentials-badge-text {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--section-accent);
    letter-spacing: 0.05em;
    text-transform: uppercase;
  }

  /* ========================================
     Headline Styles
     ======================================== */
  .credentials-headline {
    font-size: clamp(1.875rem, 4vw, 3rem);
    font-weight: 700;
    line-height: 1.2;
    color: var(--section-text);
    letter-spacing: -0.02em;
  }

  .credentials-tagline {
    margin-top: 1rem;
    font-size: 1.125rem;
    line-height: 1.7;
    color: var(--section-text-muted);
    max-width: 40rem;
  }

  /* ========================================
     Grid Layout
     ======================================== */
  .credentials-grid {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  @media (min-width: 1024px) {
    .credentials-grid {
      display: grid;
      grid-template-columns: 1.5fr 1fr;
      gap: 2rem;
      align-items: start;
    }
  }

  .credentials-secondary-grid {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  /* ========================================
     Primary Card (Hero)
     ======================================== */
  .credential-card--primary {
    position: relative;
    padding: 2.5rem;
    background: var(--section-card-bg);
    border: 1px solid var(--section-card-border);
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .credential-card--primary:hover {
    border-color: color-mix(in srgb, var(--section-accent) 50%, transparent);
    transform: translateY(-2px);
  }

  @media (min-width: 768px) {
    .credential-card--primary {
      padding: 3rem;
    }
  }

  /* Pattern Background */
  .credential-card__pattern {
    position: absolute;
    inset: 0;
    opacity: 0.04;
    background-image:
      radial-gradient(circle at 20% 80%, var(--section-accent) 1px, transparent 1px),
      radial-gradient(circle at 80% 20%, var(--section-accent) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
  }

  /* Glow Effect */
  .credential-card__glow {
    position: absolute;
    top: -50%;
    right: -30%;
    width: 60%;
    height: 100%;
    background: radial-gradient(
      ellipse,
      color-mix(in srgb, var(--section-accent) 15%, transparent),
      transparent 60%
    );
    opacity: 0;
    transition: opacity 0.4s ease;
    pointer-events: none;
  }

  .credential-card--primary:hover .credential-card__glow {
    opacity: 1;
  }

  /* Badge on Primary Card */
  .credential-card__badge {
    position: absolute;
    top: 1.5rem;
    right: 1.5rem;
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.375rem 0.75rem;
    background: var(--section-accent);
    color: var(--section-card-bg);
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-radius: 9999px;
  }

  /* ========================================
     Secondary Cards
     ======================================== */
  .credential-card--secondary {
    position: relative;
    padding: 1.5rem;
    background: color-mix(in srgb, var(--section-card-bg) 60%, transparent);
    border: 1px solid var(--section-card-border);
    transition: all 0.3s ease;
  }

  .credential-card--secondary:hover {
    background: var(--section-card-bg);
    border-color: color-mix(in srgb, var(--section-accent) 30%, transparent);
  }

  /* ========================================
     Card Content
     ======================================== */
  .credential-card__content {
    position: relative;
    z-index: 10;
  }

  .credential-card__content--row {
    display: flex;
    gap: 1.25rem;
    align-items: flex-start;
  }

  /* ========================================
     Icon Styles
     ======================================== */
  .credential-card__icon-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: all 0.3s ease;
  }

  .credential-card__icon-wrapper--primary {
    width: 4.5rem;
    height: 4.5rem;
    margin-bottom: 1.5rem;
    background: linear-gradient(
      135deg,
      color-mix(in srgb, var(--section-accent) 20%, transparent),
      color-mix(in srgb, var(--section-accent) 10%, transparent)
    );
    border: 2px solid color-mix(in srgb, var(--section-accent) 40%, transparent);
  }

  .credential-card--primary:hover .credential-card__icon-wrapper--primary {
    transform: scale(1.05) rotate(-3deg);
    border-color: var(--section-accent);
  }

  .credential-card__icon-wrapper--secondary {
    width: 3rem;
    height: 3rem;
    background: color-mix(in srgb, var(--section-accent) 12%, transparent);
    border: 1px solid color-mix(in srgb, var(--section-accent) 20%, transparent);
  }

  .credential-card--secondary:hover .credential-card__icon-wrapper--secondary {
    background: color-mix(in srgb, var(--section-accent) 18%, transparent);
  }

  .credential-card__icon {
    width: 2rem;
    height: 2rem;
    color: var(--section-accent);
  }

  .credential-card__icon--small {
    width: 1.25rem;
    height: 1.25rem;
  }

  /* ========================================
     Text Styles
     ======================================== */
  .credential-card__title--primary {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--section-text);
    margin-bottom: 0.5rem;
    line-height: 1.3;
  }

  .credential-card__title--secondary {
    font-size: 1rem;
    font-weight: 600;
    color: var(--section-text);
    margin-bottom: 0.25rem;
    line-height: 1.3;
  }

  .credential-card__subtitle--primary {
    font-size: 1.125rem;
    color: var(--section-accent);
    font-weight: 500;
    margin-bottom: 1.5rem;
  }

  .credential-card__subtitle--secondary {
    font-size: 0.875rem;
    color: var(--section-text-muted);
    line-height: 1.5;
  }

  .credential-card__institution {
    font-size: 0.8125rem;
    color: color-mix(in srgb, var(--section-text-muted) 70%, transparent);
    margin-top: 0.25rem;
  }

  @media (min-width: 768px) {
    .credential-card__title--primary {
      font-size: 1.75rem;
    }

    .credential-card__title--secondary {
      font-size: 1.0625rem;
    }
  }

  /* ========================================
     Meta Info (Primary Card)
     ======================================== */
  .credential-card__meta {
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--section-card-border);
  }

  .credential-card__meta-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9375rem;
    color: var(--section-text-muted);
  }

  .credential-card__meta-item svg {
    color: color-mix(in srgb, var(--section-accent) 70%, transparent);
  }

  /* ========================================
     SINGLE CREDENTIAL HERO MODE
     ======================================== */
  .credential-hero {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    padding: 3rem 1.5rem;
  }

  @media (min-width: 768px) {
    .credential-hero {
      padding: 4rem 2rem;
    }
  }

  /* Decorative Rings */
  .credential-hero__decoration {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none;
    overflow: hidden;
  }

  .credential-hero__ring {
    position: absolute;
    border-radius: 50%;
    border: 1px solid color-mix(in srgb, var(--section-accent) 15%, transparent);
  }

  .credential-hero__ring--1 {
    width: 200px;
    height: 200px;
    animation: pulse-ring 4s ease-in-out infinite;
  }

  .credential-hero__ring--2 {
    width: 320px;
    height: 320px;
    animation: pulse-ring 4s ease-in-out infinite 0.5s;
  }

  .credential-hero__ring--3 {
    width: 440px;
    height: 440px;
    animation: pulse-ring 4s ease-in-out infinite 1s;
  }

  @keyframes pulse-ring {
    0%, 100% {
      opacity: 0.3;
      transform: scale(1);
    }
    50% {
      opacity: 0.6;
      transform: scale(1.02);
    }
  }

  @media (min-width: 768px) {
    .credential-hero__ring--1 {
      width: 280px;
      height: 280px;
    }

    .credential-hero__ring--2 {
      width: 420px;
      height: 420px;
    }

    .credential-hero__ring--3 {
      width: 560px;
      height: 560px;
    }
  }

  /* Hero Icon */
  .credential-hero__icon-wrapper {
    position: relative;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 5rem;
    height: 5rem;
    margin-bottom: 1.5rem;
    background: linear-gradient(
      135deg,
      color-mix(in srgb, var(--section-accent) 25%, transparent),
      color-mix(in srgb, var(--section-accent) 12%, transparent)
    );
    border: 2px solid color-mix(in srgb, var(--section-accent) 50%, transparent);
    box-shadow:
      0 0 40px color-mix(in srgb, var(--section-accent) 20%, transparent),
      0 0 80px color-mix(in srgb, var(--section-accent) 10%, transparent);
  }

  @media (min-width: 768px) {
    .credential-hero__icon-wrapper {
      width: 6rem;
      height: 6rem;
      margin-bottom: 2rem;
    }
  }

  .credential-hero__icon {
    width: 2.5rem;
    height: 2.5rem;
    color: var(--section-accent);
  }

  @media (min-width: 768px) {
    .credential-hero__icon {
      width: 3rem;
      height: 3rem;
    }
  }

  /* Hero Badge */
  .credential-hero__badge {
    position: relative;
    z-index: 10;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    margin-bottom: 1.25rem;
    background: color-mix(in srgb, var(--section-accent) 12%, transparent);
    border: 1px solid color-mix(in srgb, var(--section-accent) 30%, transparent);
    border-radius: 9999px;
    font-size: 0.8125rem;
    font-weight: 600;
    color: var(--section-accent);
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }

  /* Hero Title */
  .credential-hero__title {
    position: relative;
    z-index: 10;
    font-size: clamp(1.75rem, 5vw, 2.75rem);
    font-weight: 700;
    line-height: 1.15;
    color: var(--section-text);
    letter-spacing: -0.02em;
    margin-bottom: 0.75rem;
  }

  /* Hero Subtitle */
  .credential-hero__subtitle {
    position: relative;
    z-index: 10;
    font-size: clamp(1.125rem, 2.5vw, 1.5rem);
    font-weight: 500;
    color: var(--section-accent);
    margin-bottom: 2rem;
  }

  /* Hero Meta */
  .credential-hero__meta {
    position: relative;
    z-index: 10;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 1.5rem 2.5rem;
    padding: 1.5rem 2rem;
    background: var(--section-card-bg);
    border: 1px solid var(--section-card-border);
    margin-bottom: 2rem;
  }

  .credential-hero__meta-item {
    display: flex;
    align-items: center;
    gap: 0.625rem;
    font-size: 1rem;
    color: var(--section-text-muted);
  }

  .credential-hero__meta-item svg {
    color: var(--section-accent);
    opacity: 0.8;
  }

  @media (min-width: 768px) {
    .credential-hero__meta-item {
      font-size: 1.0625rem;
    }
  }

  /* Hero Highlights */
  .credential-hero__highlights {
    position: relative;
    z-index: 10;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 0.75rem;
    max-width: 36rem;
  }

  .credential-hero__highlight-tag {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.625rem 1rem;
    background: color-mix(in srgb, var(--section-card-bg) 80%, transparent);
    border: 1px solid var(--section-card-border);
    border-radius: 9999px;
    font-size: 0.875rem;
    color: var(--section-text-muted);
    transition: all 0.2s ease;
  }

  .credential-hero__highlight-tag:hover {
    background: var(--section-card-bg);
    border-color: color-mix(in srgb, var(--section-accent) 40%, transparent);
    color: var(--section-text);
  }

  .credential-hero__highlight-tag svg {
    color: var(--section-accent);
    flex-shrink: 0;
  }

  /* ========================================
     Reduced Motion
     ======================================== */
  @media (prefers-reduced-motion: reduce) {
    .credential-card--primary,
    .credential-card--secondary,
    .credential-card__icon-wrapper,
    .credential-card__glow,
    .credential-hero__ring {
      transition: none;
      animation: none;
    }

    .credential-card--primary:hover,
    .credential-card--secondary:hover {
      transform: none;
    }

    .credential-card--primary:hover .credential-card__icon-wrapper--primary {
      transform: none;
    }
  }
</style>
