---
import Container from "@components/shared/Container.astro";
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";
import type { SectionVariant } from "../../types";

// Import all images from assets for dynamic resolution
const assetImages = import.meta.glob<{ default: ImageMetadata }>(
  "/src/assets/**/*.{png,jpg,jpeg,webp}",
);

interface ImageItem {
  src: string;
  alt: string;
}

interface Props {
  sectionVariant?: SectionVariant;
  images?: ImageItem[];
  aspectRatio?: "square" | "portrait" | "landscape" | "auto";
  gap?: "sm" | "md" | "lg";
  rounded?: "none" | "md" | "lg" | "xl" | "2xl" | "3xl";
  /** Width ratio for left image, e.g. "50-50", "60-40", "40-60", "70-30" */
  ratio?: "50-50" | "60-40" | "40-60" | "70-30" | "30-70";
  /** Container max width: default "2xl" for wider layout */
  containerSize?: "xl" | "2xl" | "full";
}

const {
  sectionVariant = "white",
  images = [
    {
      src: "https://images.unsplash.com/photo-1441986300917-64674bd600d8?w=800&h=1000&fit=crop",
      alt: "Produkt",
    },
    {
      src: "https://images.unsplash.com/photo-1469334031218-e382a71b716b?w=800&h=1000&fit=crop",
      alt: "Model",
    },
  ],
  aspectRatio = "portrait",
  gap = "md",
  rounded = "2xl",
  ratio = "50-50",
  containerSize = "2xl",
} = Astro.props;

// Resolve images from src/assets
interface ResolvedImage extends ImageItem {
  resolvedImage?: ImageMetadata;
}

const resolvedImages: ResolvedImage[] = await Promise.all(
  images.map(async (img) => {
    if (img.src?.startsWith("/src/")) {
      const imageModule = assetImages[img.src];
      if (imageModule) {
        const resolved = await imageModule();
        return { ...img, resolvedImage: resolved.default };
      }
    }
    return { ...img };
  }),
);

// Gap classes
const gapClasses = {
  sm: "gap-2 sm:gap-3 lg:gap-4",
  md: "gap-3 sm:gap-4 lg:gap-6",
  lg: "gap-4 sm:gap-6 lg:gap-8",
};

// Aspect ratio classes
const aspectClasses = {
  square: "aspect-square",
  portrait: "aspect-[3/4]",
  landscape: "aspect-[4/3]",
  auto: "",
};

// Rounded classes
const roundedClasses = {
  none: "rounded-none",
  md: "rounded-md",
  lg: "rounded-lg",
  xl: "rounded-xl",
  "2xl": "rounded-2xl",
  "3xl": "rounded-3xl",
};

// Ratio classes using CSS Grid fr units
const ratioClasses = {
  "50-50": "grid-cols-2",
  "60-40": "grid-cols-[3fr_2fr]",
  "40-60": "grid-cols-[2fr_3fr]",
  "70-30": "grid-cols-[7fr_3fr]",
  "30-70": "grid-cols-[3fr_7fr]",
};

// Container size classes
const containerSizeClasses = {
  xl: "max-w-screen-xl",
  "2xl": "max-w-screen-2xl",
  full: "max-w-none",
};
---

<div class="image-pair" data-variant={sectionVariant}>
  <Container class={containerSizeClasses[containerSize]}>
    <div class:list={["grid", ratioClasses[ratio], gapClasses[gap]]}>
      {
        resolvedImages.slice(0, 2).map((image, index) => (
          <div
            class:list={[
              "image-pair__item fade-up overflow-hidden",
              aspectClasses[aspectRatio],
              roundedClasses[rounded],
            ]}
            style={`transition-delay: ${100 + index * 100}ms;`}
          >
            {image.resolvedImage ? (
              <Image
                src={image.resolvedImage}
                alt={image.alt}
                class="h-full w-full object-cover transition-transform duration-500 hover:scale-105"
                loading="lazy"
              />
            ) : (
              <img
                src={image.src}
                alt={image.alt}
                class="h-full w-full object-cover transition-transform duration-500 hover:scale-105"
                loading="lazy"
              />
            )}
          </div>
        ))
      }
    </div>
  </Container>
</div>

<style>
  /* ========================================
     Uses --section-* variables set by data-section-theme
     attribute on parent Section component
     ======================================== */

  .image-pair__item {
    background: color-mix(in srgb, var(--section-text-muted) 10%, transparent);
    box-shadow:
      0 4px 6px -1px rgb(0 0 0 / 0.1),
      0 2px 4px -2px rgb(0 0 0 / 0.1);
  }

  .image-pair__item:hover {
    box-shadow:
      0 10px 15px -3px rgb(0 0 0 / 0.1),
      0 4px 6px -4px rgb(0 0 0 / 0.1);
  }
</style>
