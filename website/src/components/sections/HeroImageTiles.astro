---
import Button from "@components/shared/Button.astro";
import { Icon } from "astro-icon/components";
import type { SectionVariant } from "../../types";

interface Props {
  sectionVariant?: SectionVariant;
  badge?: string;
  badgeIcon?: string;
  headline: string;
  subheadline: string;
  primaryCta?: string;
  primaryCtaHref?: string;
  secondaryCta?: string;
  secondaryCtaHref?: string;
  images: string[];
  imageAlts?: string[];
}

const {
  sectionVariant = "white",
  badge,
  badgeIcon = "heroicons:sparkles-16-solid",
  headline,
  subheadline,
  primaryCta = "Kostenloses Erstgespr√§ch",
  primaryCtaHref,
  secondaryCta = "Erfolgsbeispiele ansehen",
  secondaryCtaHref = "#cases",
  images = [],
  imageAlts = [],
} = Astro.props;

// Variant-based styles
const isDarkVariant = sectionVariant === "dark" || sectionVariant === "primary";

// Button variants
const primaryButtonVariant = sectionVariant === "primary" ? "white" : "primary";
const secondaryButtonVariant = isDarkVariant ? "secondary-dark" : "secondary";

// Process headline: replace <em> tags with styled spans using CSS variable
const highlightStyle = `color: var(--section-accent);`;
const processedHeadline = headline.replace(
  /<em>(.*?)<\/em>/g,
  `<span style="${highlightStyle}">$1</span>`,
);

// Ensure we have 5 images for the layout
const displayImages = [
  images[0] ||
    "https://images.unsplash.com/photo-1557804506-669a67965ba0?auto=format&fit=crop&h=528&q=80",
  images[1] ||
    "https://images.unsplash.com/photo-1485217988980-11786ced9454?auto=format&fit=crop&h=528&q=80",
  images[2] ||
    "https://images.unsplash.com/photo-1559136555-9303baea8ebd?auto=format&fit=crop&h=528&q=80",
  images[3] ||
    "https://images.unsplash.com/photo-1670272504528-790c24957dda?auto=format&fit=crop&h=528&q=80",
  images[4] ||
    "https://images.unsplash.com/photo-1670272505284-8faba1c31f7d?auto=format&fit=crop&h=528&q=80",
];
---

<div
  id="hero"
  class="heroimagetiles-section relative isolate pt-20 sm:pt-24 lg:pt-0"
  data-variant={sectionVariant}
>
  {/* Gradient Blur Decoration */}
  <div
    aria-hidden="true"
    class="absolute top-0 right-0 left-1/2 -z-10 -ml-24 transform-gpu overflow-hidden blur-3xl lg:ml-24 xl:ml-48"
  >
    <div
      style="clip-path: polygon(63.1% 29.5%, 100% 17.1%, 76.6% 3%, 48.4% 0%, 44.6% 4.7%, 54.5% 25.3%, 59.8% 49%, 55.2% 57.8%, 44.4% 57.2%, 27.8% 47.9%, 35.1% 81.5%, 0% 97.7%, 39.2% 100%, 35.2% 81.4%, 97.2% 52.8%, 63.1% 29.5%)"
      class="heroimagetiles-gradient-blob aspect-801/1036 w-200.25 opacity-30"
    >
    </div>
  </div>

  <div class="overflow-hidden">
    <div class="mx-auto max-w-7xl px-6 pt-12 pb-32 sm:pt-20 lg:px-8 lg:pt-32">
      <div
        class="mx-auto max-w-2xl gap-x-14 lg:mx-0 lg:flex lg:max-w-none lg:items-center"
      >
        {/* Content */}
        <div class="relative w-full lg:max-w-xl lg:shrink-0 xl:max-w-2xl">
          {/* Badge */}
          {
            badge && (
              <div class="heroimagetiles-badge blur-in shadow-inner-blur mb-6 inline-flex items-center rounded-full">
                <div class="heroimagetiles-badge-inner flex h-full w-full items-center space-x-2 rounded-full border px-4 py-1.5">
                  <Icon
                    name={badgeIcon}
                    class="heroimagetiles-badge-icon h-4 w-4"
                  />
                  <span class="heroimagetiles-badge-text text-sm font-medium">
                    {badge}
                  </span>
                </div>
              </div>
            )
          }

          {/* Headline */}
          <h1
            class="heroimagetiles-headline scale-up text-4xl leading-[1.1] font-bold tracking-tight text-pretty sm:text-5xl lg:text-6xl"
            style="transition-delay: 100ms;"
            set:html={processedHeadline}
          />

          {/* Subheadline */}
          <p
            class="heroimagetiles-subheadline fade-up mt-8 text-lg font-medium text-pretty sm:max-w-md sm:text-xl/8 lg:max-w-none"
            style="transition-delay: 200ms;"
          >
            {subheadline}
          </p>

          {/* CTAs */}
          <div
            class="fade-up mt-10 flex flex-col items-start gap-4 sm:flex-row sm:items-center sm:gap-5"
            style="transition-delay: 300ms;"
          >
            <Button
              data-open-funnel={!primaryCtaHref}
              href={primaryCtaHref}
              variant={primaryButtonVariant}
              size="lg"
            >
              <Icon name="heroicons:calendar-days-16-solid" class="h-4 w-4" />
              <span>{primaryCta}</span>
            </Button>
            <Button
              href={secondaryCtaHref}
              variant={secondaryButtonVariant}
              size="lg"
            >
              <span>{secondaryCta}</span>
              <Icon name="heroicons:arrow-right-16-solid" class="h-4 w-4" />
            </Button>
          </div>
        </div>

        {/* Image Tiles */}
        <div
          class="fade-up mt-14 flex justify-end gap-8 sm:-mt-44 sm:justify-start sm:pl-20 lg:mt-0 lg:pl-0"
          style="transition-delay: 400ms;"
        >
          {/* Column 1 - Single image at bottom */}
          <div
            class="ml-auto w-44 flex-none space-y-8 pt-32 sm:ml-0 sm:pt-80 lg:order-last lg:pt-36 xl:order-0 xl:pt-80"
          >
            <div class="relative">
              <img
                src={displayImages[0]}
                alt={imageAlts[0] || ""}
                class="heroimagetiles-image aspect-2/3 w-full rounded-xl object-cover shadow-lg"
              />
              <div
                class="heroimagetiles-image-ring pointer-events-none absolute inset-0 rounded-xl ring-1 ring-inset"
              >
              </div>
            </div>
          </div>

          {/* Column 2 - Two images stacked */}
          <div
            class="mr-auto w-44 flex-none space-y-8 sm:mr-0 sm:pt-52 lg:pt-36"
          >
            <div class="relative">
              <img
                src={displayImages[1]}
                alt={imageAlts[1] || ""}
                class="heroimagetiles-image aspect-2/3 w-full rounded-xl object-cover shadow-lg"
              />
              <div
                class="heroimagetiles-image-ring pointer-events-none absolute inset-0 rounded-xl ring-1 ring-inset"
              >
              </div>
            </div>
            <div class="relative">
              <img
                src={displayImages[2]}
                alt={imageAlts[2] || ""}
                class="heroimagetiles-image aspect-2/3 w-full rounded-xl object-cover shadow-lg"
              />
              <div
                class="heroimagetiles-image-ring pointer-events-none absolute inset-0 rounded-xl ring-1 ring-inset"
              >
              </div>
            </div>
          </div>

          {/* Column 3 - Two images stacked (different offset) */}
          <div class="w-44 flex-none space-y-8 pt-32 sm:pt-0">
            <div class="relative">
              <img
                src={displayImages[3]}
                alt={imageAlts[3] || ""}
                class="heroimagetiles-image aspect-2/3 w-full rounded-xl object-cover shadow-lg"
              />
              <div
                class="heroimagetiles-image-ring pointer-events-none absolute inset-0 rounded-xl ring-1 ring-inset"
              >
              </div>
            </div>
            <div class="relative">
              <img
                src={displayImages[4]}
                alt={imageAlts[4] || ""}
                class="heroimagetiles-image aspect-2/3 w-full rounded-xl object-cover shadow-lg"
              />
              <div
                class="heroimagetiles-image-ring pointer-events-none absolute inset-0 rounded-xl ring-1 ring-inset"
              >
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  import "@scripts/animations";
</script>

<style>
  /* ========================================
     Uses --section-* variables set by data-section-theme
     attribute on parent Section component
     ======================================== */

  /* ========================================
     Badge styles
     ======================================== */
  .heroimagetiles-badge {
    background: color-mix(in srgb, var(--section-accent) 15%, transparent);
  }

  .heroimagetiles-badge-inner {
    border-color: color-mix(in srgb, var(--section-accent) 30%, transparent);
  }

  .heroimagetiles-badge-icon {
    color: var(--section-accent);
  }

  .heroimagetiles-badge-text {
    color: var(--section-text);
  }

  /* ========================================
     Headline styles
     ======================================== */
  .heroimagetiles-headline {
    color: var(--section-text);
  }

  .heroimagetiles-subheadline {
    color: var(--section-text-muted);
  }

  /* ========================================
     Image styles
     ======================================== */
  .heroimagetiles-image {
    background: color-mix(in srgb, var(--section-text) 5%, transparent);
  }

  .heroimagetiles-image-ring {
    --tw-ring-color: color-mix(in srgb, var(--section-text) 10%, transparent);
  }

  /* ========================================
     Gradient blob styles
     ======================================== */
  .heroimagetiles-gradient-blob {
    background: linear-gradient(
      to top right,
      color-mix(in srgb, var(--section-accent) 30%, transparent),
      color-mix(in srgb, var(--section-accent) 20%, transparent)
    );
  }
</style>
