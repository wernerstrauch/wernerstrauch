---
interface Props {
  variant?: "light" | "dark";
}

const { variant = "light" } = Astro.props;
const uniqueId = `dataflow-${Math.random().toString(36).substring(2, 11)}`;
---

<div class="absolute inset-0 overflow-hidden pointer-events-none" data-variant={variant}>
  <svg
    viewBox="0 0 400 600"
    class="w-full h-full"
    xmlns="http://www.w3.org/2000/svg"
  >
    <defs>
      <radialGradient id={`nodeGlow-${uniqueId}`}>
        <stop offset="0%" stop-color="var(--color-primary)" stop-opacity="0.8" />
        <stop offset="50%" stop-color="var(--color-primary)" stop-opacity="0.4" />
        <stop offset="100%" stop-color="var(--color-primary)" stop-opacity="0" />
      </radialGradient>

      <linearGradient id={`pathGrad-${uniqueId}`} x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" stop-color="var(--color-primary)" stop-opacity="0.5" />
        <stop offset="100%" stop-color="var(--color-secondary)" stop-opacity="0.3" />
      </linearGradient>
    </defs>

    {/* Animated Paths */}
    <path
      class="animated-path"
      d="M 50,80 Q 120,120 200,180 T 300,280"
      fill="none"
      stroke={`url(#pathGrad-${uniqueId})`}
      stroke-width="3"
      pathLength="100"
    />
    <path
      class="animated-path"
      d="M 350,100 Q 280,150 220,200 T 120,320"
      fill="none"
      stroke={`url(#pathGrad-${uniqueId})`}
      stroke-width="3"
      pathLength="100"
      style="animation-delay: 2s;"
    />
    <path
      class="animated-path"
      d="M 200,240 Q 240,320 200,400 T 180,520"
      fill="none"
      stroke={`url(#pathGrad-${uniqueId})`}
      stroke-width="3"
      pathLength="100"
      style="animation-delay: 4s;"
    />

    {/* Pulsing Nodes */}
    <g class="node">
      <circle cx="200" cy="240" r="25" fill={`url(#nodeGlow-${uniqueId})`} />
      <circle cx="200" cy="240" r="10" fill="var(--color-primary)" opacity="0.7" />
      <circle class="pulse" cx="200" cy="240" r="10" fill="none" stroke="var(--color-primary)" stroke-width="2" />
    </g>

    <g class="node" style="animation-delay: 0.5s;">
      <circle cx="50" cy="80" r="18" fill={`url(#nodeGlow-${uniqueId})`} />
      <circle cx="50" cy="80" r="7" fill="var(--color-primary)" opacity="0.6" />
      <circle class="pulse" cx="50" cy="80" r="7" fill="none" stroke="var(--color-primary)" stroke-width="2" />
    </g>

    <g class="node" style="animation-delay: 1s;">
      <circle cx="350" cy="100" r="18" fill={`url(#nodeGlow-${uniqueId})`} />
      <circle cx="350" cy="100" r="7" fill="var(--color-primary)" opacity="0.6" />
      <circle class="pulse" cx="350" cy="100" r="7" fill="none" stroke="var(--color-primary)" stroke-width="2" />
    </g>
  </svg>
</div>

<style>
  [data-variant="light"] {
    --color-primary: #4f3ca2;
    --color-secondary: #6b5bb5;
  }

  [data-variant="dark"] {
    --color-primary: #b4e565;
    --color-secondary: #9dd84f;
  }

  .animated-path {
    stroke-dasharray: 10 90;
    stroke-dashoffset: 0;
    animation: flowPath 10s ease-in-out infinite;
  }

  @keyframes flowPath {
    0% {
      stroke-dashoffset: -10;
      opacity: 0;
    }
    10% {
      opacity: 1;
    }
    90% {
      opacity: 1;
    }
    100% {
      stroke-dashoffset: 100;
      opacity: 0;
    }
  }

  .pulse {
    animation: pulsing 3s ease-in-out infinite;
  }

  @keyframes pulsing {
    0%, 100% {
      r: 7;
      opacity: 0.8;
    }
    50% {
      r: 15;
      opacity: 0;
    }
  }
</style>
