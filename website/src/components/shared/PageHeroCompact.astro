---
import Container from "@components/shared/Container.astro";
import { Icon } from "astro-icon/components";
import type { SectionVariant } from "../../types";

interface Breadcrumb {
  label: string;
  href: string;
}

interface Props {
  sectionVariant?: SectionVariant;
  icon: string;
  title: string;
  description: string;
  breadcrumbs?: Breadcrumb[];
}

const {
  sectionVariant = "dark",
  icon,
  title,
  description,
  breadcrumbs,
} = Astro.props;

// Generate Schema.org BreadcrumbList
const breadcrumbSchema =
  breadcrumbs && breadcrumbs.length > 0
    ? {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        itemListElement: [
          {
            "@type": "ListItem",
            position: 1,
            name: "Startseite",
            item: Astro.site?.href,
          },
          ...breadcrumbs.map((crumb, index) => ({
            "@type": "ListItem",
            position: index + 2,
            name: crumb.label,
            ...(index < breadcrumbs.length - 1
              ? { item: new URL(crumb.href, Astro.site).href }
              : {}),
          })),
        ],
      }
    : null;
---

{/* Schema.org BreadcrumbList */}
{
  breadcrumbSchema && (
    <script
      is:inline
      type="application/ld+json"
      set:html={JSON.stringify(breadcrumbSchema)}
    />
  )
}

<section
  class="page-hero-compact relative overflow-hidden pt-32"
  data-section-theme={sectionVariant}
>
  <Container>
    {/* Breadcrumbs */}
    {
      breadcrumbs && breadcrumbs.length > 0 && (
        <nav class="mb-6" aria-label="Breadcrumb">
          <ol class="page-hero-compact__breadcrumb flex items-center gap-2 text-sm">
            <li>
              <a
                href="/"
                class="page-hero-compact__breadcrumb-link transition-colors"
                aria-label="Startseite"
              >
                <Icon name="heroicons:home-16-solid" class="h-4 w-4" />
              </a>
            </li>
            {breadcrumbs.map((crumb, index) => (
              <>
                <li aria-hidden="true">
                  <Icon
                    name="heroicons:chevron-right-16-solid"
                    class="page-hero-compact__chevron h-4 w-4"
                  />
                </li>
                <li>
                  {index === breadcrumbs.length - 1 ? (
                    <span class="page-hero-compact__breadcrumb-current">
                      {crumb.label}
                    </span>
                  ) : (
                    <a
                      href={crumb.href}
                      class="page-hero-compact__breadcrumb-link transition-colors"
                    >
                      {crumb.label}
                    </a>
                  )}
                </li>
              </>
            ))}
          </ol>
        </nav>
      )
    }

    <div class="flex flex-col items-start gap-6 sm:flex-row sm:items-center">
      {/* Icon */}
      <div
        class="page-hero-compact__icon-box flex h-16 w-16 shrink-0 items-center justify-center rounded-2xl border sm:h-20 sm:w-20"
      >
        <Icon
          name={icon}
          class="page-hero-compact__icon h-8 w-8 sm:h-10 sm:w-10"
        />
      </div>

      {/* Content */}
      <div class="flex-1">
        <h1
          class="page-hero-compact__title text-3xl leading-tight font-bold sm:text-4xl lg:text-5xl"
        >
          {title}
        </h1>
        <p
          class="page-hero-compact__description mt-3 max-w-2xl text-lg leading-relaxed"
        >
          {description}
        </p>
      </div>
    </div>
  </Container>
</section>

<style>
  /* ========================================
     Uses --section-* variables set by data-section-theme
     attribute on parent Section component
     ======================================== */

  .page-hero-compact__breadcrumb {
    color: var(--section-text-muted);
  }

  .page-hero-compact__breadcrumb-link {
    color: inherit;
  }

  .page-hero-compact__breadcrumb-link:hover {
    color: var(--section-accent);
  }

  .page-hero-compact__breadcrumb-current {
    color: var(--section-accent);
  }

  .page-hero-compact__chevron {
    color: var(--section-text-muted);
  }

  .page-hero-compact__icon-box {
    border-color: color-mix(in srgb, var(--section-accent) 30%, transparent);
    background: color-mix(in srgb, var(--section-accent) 10%, transparent);
  }

  .page-hero-compact__icon {
    color: var(--section-accent);
  }

  .page-hero-compact__title {
    color: var(--section-text);
  }

  .page-hero-compact__description {
    color: var(--section-text-muted);
  }
</style>
