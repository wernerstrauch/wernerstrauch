---
/**
 * SchemaOrg Component - Renders JSON-LD structured data
 * Supports multilingual content (DE/EN)
 *
 * Usage:
 * <SchemaOrg type="person" lang={lang} />
 * <SchemaOrg type="website" lang={lang} />
 * <SchemaOrg type="service" service={{ name, description, url }} lang={lang} />
 * <SchemaOrg type="breadcrumb" items={[{ name, url }]} lang={lang} />
 * <SchemaOrg type="faq" faqs={[{ question, answer }]} />
 */

import type { SupportedLanguage } from "@lib/i18n";
import {
  generatePersonSchema,
  generateWebSiteSchema,
  generateProfessionalServiceSchema,
  generateServiceSchema,
  generateBreadcrumbSchema,
  generateFAQSchema,
  generateWebPageSchema,
  generateOrganizationSchema,
  getServiceSchemaForPage,
} from "@lib/schema";

interface BreadcrumbItem {
  name: string;
  url: string;
}

interface FAQItem {
  question: string;
  answer: string;
}

interface ServiceProps {
  name: string;
  description: string;
  url: string;
  serviceType?: string;
  image?: string;
}

interface WebPageProps {
  name: string;
  description: string;
  url: string;
  dateModified?: string;
}

interface Props {
  type: "person" | "website" | "professionalService" | "service" | "breadcrumb" | "faq" | "webPage" | "organization" | "serviceBySlug";
  // Language for multilingual schemas
  lang?: SupportedLanguage;
  // For service type
  service?: ServiceProps;
  // For serviceBySlug type
  slug?: string;
  // For breadcrumb type
  items?: BreadcrumbItem[];
  // For faq type
  faqs?: FAQItem[];
  // For webPage type
  page?: WebPageProps;
}

const { type, lang = "de", service, slug, items, faqs, page } = Astro.props;

function getSchemaData() {
  switch (type) {
    case "person":
      return generatePersonSchema(lang);
    case "website":
      return generateWebSiteSchema(lang);
    case "professionalService":
      return generateProfessionalServiceSchema(lang);
    case "service":
      if (!service) return null;
      return generateServiceSchema({ ...service, lang });
    case "serviceBySlug":
      if (!slug) return null;
      return getServiceSchemaForPage(slug, lang);
    case "breadcrumb":
      if (!items || items.length === 0) return null;
      return generateBreadcrumbSchema(items, lang);
    case "faq":
      if (!faqs || faqs.length === 0) return null;
      return generateFAQSchema(faqs);
    case "webPage":
      if (!page) return null;
      return generateWebPageSchema({ ...page, lang });
    case "organization":
      return generateOrganizationSchema(lang);
    default:
      return null;
  }
}

const schemaData = getSchemaData();
---

{schemaData && (
  <script
    is:inline
    type="application/ld+json"
    set:html={JSON.stringify(schemaData)}
  />
)}
